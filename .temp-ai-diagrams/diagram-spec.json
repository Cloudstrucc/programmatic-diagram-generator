{
  "name": "aws_serverless_architecture",
  "title": "Enterprise AWS Serverless Architecture",
  "description": "Comprehensive serverless architecture showing API layer with CloudFront and WAF, Lambda compute layer with Step Functions orchestration, multi-tier data storage, enterprise security with KMS key hierarchy, event-driven messaging, and full observability stack",
  "python_code": "from diagrams import Diagram, Cluster, Edge\nfrom diagrams.aws.compute import Lambda\nfrom diagrams.aws.database import Dynamodb, ElastiCache\nfrom diagrams.aws.network import CloudFront, APIGateway\nfrom diagrams.aws.storage import S3\nfrom diagrams.aws.security import IAM, Cognito, KMS, SecretsManager, WAF\nfrom diagrams.aws.integration import SQS, SNS, Eventbridge, StepFunctions\nfrom diagrams.aws.analytics import Kinesis\nfrom diagrams.aws.management import Cloudwatch, Cloudtrail\nfrom diagrams.aws.general import Users\nfrom diagrams.aws.devtools import Codepipeline, Codecommit, Codebuild\n\ngraph_attr = {\n    \"fontsize\": \"24\",\n    \"bgcolor\": \"white\",\n    \"pad\": \"0.6\",\n    \"splines\": \"ortho\",\n    \"nodesep\": \"0.7\",\n    \"ranksep\": \"0.9\",\n}\n\nwith Diagram(\n    \"Enterprise AWS Serverless Architecture\",\n    filename=\"OUTPUT_PATH\",\n    outformat=\"png\",\n    show=False,\n    direction=\"LR\",\n    graph_attr=graph_attr\n):\n    # External Users\n    users = Users(\"Web/Mobile\nUsers\")\n    \n    # API Layer\n    with Cluster(\"API Layer\", graph_attr={\"bgcolor\": \"#e8f5e9\"}):\n        cdn = CloudFront(\"CloudFront\nCDN\n(Global Edge)\")\n        waf = WAF(\"WAF\n(DDoS/SQL\nProtection)\")\n        api_gw = APIGateway(\"API Gateway\n(REST/HTTP)\nThrottling\")\n        \n        cdn >> Edge(label=\"Filter\", color=\"red\", style=\"bold\") >> waf\n        waf >> Edge(label=\"Protected\nRequests\", color=\"blue\") >> api_gw\n    \n    # Identity & Authentication\n    with Cluster(\"Identity & Access Control\", graph_attr={\"bgcolor\": \"#e3f2fd\"}):\n        cognito = Cognito(\"Cognito\nUser Pools\n(Authentication)\")\n        iam = IAM(\"IAM Roles\nLeast Privilege\n(Authorization)\")\n        \n        api_gw >> Edge(label=\"JWT\nValidation\", color=\"purple\", style=\"dashed\") >> cognito\n        cognito >> Edge(label=\"Assume\nRole\", color=\"purple\", style=\"dashed\") >> iam\n    \n    # Security Layer\n    with Cluster(\"Security & Encryption\", graph_attr={\"bgcolor\": \"#ffebee\"}):\n        with Cluster(\"KMS Key Hierarchy\", graph_attr={\"bgcolor\": \"#ffcdd2\"}):\n            kms_root = KMS(\"Root CMK\n(Master Key)\")\n            kms_data = KMS(\"Data Keys\n(DynamoDB)\")\n            kms_cache = KMS(\"Cache Keys\n(ElastiCache)\")\n            kms_s3 = KMS(\"S3 Keys\n(Object Encryption)\")\n            \n            kms_root >> Edge(label=\"Wraps\", color=\"red\", style=\"bold\") >> kms_data\n            kms_root >> Edge(label=\"Wraps\", color=\"red\", style=\"bold\") >> kms_cache\n            kms_root >> Edge(label=\"Wraps\", color=\"red\", style=\"bold\") >> kms_s3\n        \n        secrets = SecretsManager(\"Secrets Manager\n(API Keys\nDB Credentials)\")\n        kms_root >> Edge(label=\"Encrypts\", color=\"red\", style=\"bold\") >> secrets\n    \n    # Compute Layer\n    with Cluster(\"Compute Layer\", graph_attr={\"bgcolor\": \"#fff3e0\"}):\n        step_fn = StepFunctions(\"Step Functions\n(Workflow\nOrchestration)\")\n        \n        with Cluster(\"Lambda Functions\", graph_attr={\"bgcolor\": \"#fff8e1\"}):\n            lambda_auth = Lambda(\"Auth Service\n(Token\nValidation)\")\n            lambda_user = Lambda(\"User Service\n(CRUD\nOperations)\")\n            lambda_order = Lambda(\"Order Service\n(Business\nLogic)\")\n            lambda_notify = Lambda(\"Notification\nService\n(Async)\")\n            lambda_analytics = Lambda(\"Analytics\nService\n(Streaming)\")\n    \n    # Data Layer\n    with Cluster(\"Data Layer\", graph_attr={\"bgcolor\": \"#e0f7fa\"}):\n        dynamodb = Dynamodb(\"DynamoDB\n(Primary Data)\nEncrypted\")\n        cache_session = ElastiCache(\"Redis\n(Session Store)\nEncrypted\")\n        cache_data = ElastiCache(\"Redis\n(Data Cache)\nTTL: 5min\")\n        s3 = S3(\"S3 Bucket\n(Object Storage)\nVersioning ON\")\n    \n    # Event-Driven Architecture\n    with Cluster(\"Event-Driven Messaging\", graph_attr={\"bgcolor\": \"#f3e5f5\"}):\n        eventbridge = Eventbridge(\"EventBridge\n(Event Bus)\nRule-based\")\n        sqs_orders = SQS(\"Order Queue\n(FIFO)\nDLQ Enabled\")\n        sqs_notify = SQS(\"Notification\nQueue\n(Standard)\")\n        sns = SNS(\"SNS Topics\n(Fan-out)\nMulti-protocol\")\n    \n    # Monitoring & Observability\n    with Cluster(\"Monitoring & Observability\", graph_attr={\"bgcolor\": \"#fff3e0\"}):\n        cw_logs = Cloudwatch(\"CloudWatch\nLogs/Metrics\nAlarms\")\n        xray = Kinesis(\"X-Ray\nTracing\n(APM)\")\n        cloudtrail = Cloudtrail(\"CloudTrail\nAudit Logs\n(Compliance)\")\n    \n    # CI/CD Pipeline\n    with Cluster(\"CI/CD Automation\", graph_attr={\"bgcolor\": \"#e8f5e9\"}):\n        codecommit = Codecommit(\"CodeCommit\n(Git Repo)\")\n        codebuild = Codebuild(\"CodeBuild\n(Build/Test)\")\n        codepipeline = Codepipeline(\"CodePipeline\n(Deploy)\")\n        \n        codecommit >> codebuild >> codepipeline\n        codepipeline >> Edge(label=\"Deploy\", color=\"green\") >> lambda_auth\n    \n    # Main Flow\n    users >> Edge(label=\"HTTPS\nRequests\", color=\"blue\") >> cdn\n    \n    # API to Lambda connections\n    api_gw >> Edge(label=\"Invoke\", color=\"blue\") >> lambda_auth\n    api_gw >> Edge(label=\"Invoke\", color=\"blue\") >> lambda_user\n    api_gw >> Edge(label=\"Invoke\", color=\"blue\") >> lambda_order\n    \n    # Lambda to Step Functions\n    lambda_order >> Edge(label=\"Complex\nWorkflow\", color=\"blue\") >> step_fn\n    step_fn >> Edge(label=\"Orchestrate\", color=\"blue\") >> lambda_analytics\n    \n    # Security connections\n    iam >> Edge(label=\"kms:Decrypt\", color=\"purple\", style=\"dashed\") >> kms_data\n    iam >> Edge(label=\"kms:Decrypt\", color=\"purple\", style=\"dashed\") >> kms_cache\n    iam >> Edge(label=\"kms:Decrypt\", color=\"purple\", style=\"dashed\") >> kms_s3\n    lambda_auth >> Edge(label=\"Get Secret\", color=\"red\", style=\"bold\") >> secrets\n    lambda_user >> Edge(label=\"Get Secret\", color=\"red\", style=\"bold\") >> secrets\n    \n    # Data connections\n    lambda_user >> Edge(label=\"Read/Write\", color=\"blue\") >> dynamodb\n    lambda_user >> Edge(label=\"Cache\nSession\", color=\"orange\", style=\"dashed\") >> cache_session\n    lambda_order >> Edge(label=\"Query\", color=\"blue\") >> dynamodb\n    lambda_order >> Edge(label=\"Cache\nHit\", color=\"orange\", style=\"dashed\") >> cache_data\n    lambda_order >> Edge(label=\"Upload\nFiles\", color=\"blue\") >> s3\n    \n    # Event-driven connections\n    lambda_order >> Edge(label=\"Publish\nEvents\", color=\"green\") >> eventbridge\n    eventbridge >> Edge(label=\"Route\", color=\"green\") >> sqs_orders\n    eventbridge >> Edge(label=\"Route\", color=\"green\") >> sns\n    sns >> Edge(label=\"Subscribe\", color=\"green\") >> sqs_notify\n    sqs_notify >> Edge(label=\"Poll\", color=\"blue\") >> lambda_notify\n    \n    # Monitoring connections\n    lambda_auth >> Edge(label=\"Logs\", color=\"gray\", style=\"dotted\") >> cw_logs\n    lambda_user >> Edge(label=\"Trace\", color=\"gray\", style=\"dotted\") >> xray\n    lambda_order >> Edge(label=\"Metrics\", color=\"gray\", style=\"dotted\") >> cw_logs\n    api_gw >> Edge(label=\"Access\nLogs\", color=\"gray\", style=\"dotted\") >> cloudtrail\n    iam >> Edge(label=\"Audit\", color=\"gray\", style=\"dotted\") >> cloudtrail\n    \n    # Encryption at rest\n    kms_data >> Edge(label=\"Encrypts\", color=\"red\", style=\"bold\") >> dynamodb\n    kms_cache >> Edge(label=\"Encrypts\", color=\"red\", style=\"bold\") >> cache_session\n    kms_cache >> Edge(label=\"Encrypts\", color=\"red\", style=\"bold\") >> cache_data\n    kms_s3 >> Edge(label=\"Encrypts\", color=\"red\", style=\"bold\") >> s3",
  "style": "aws",
  "quality": "enterprise"
}