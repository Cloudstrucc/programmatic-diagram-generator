{
  "name": "azure_cmk_architecture",
  "title": "Azure CMK Architecture with Key Vault and Managed Identity",
  "description": "Complete Azure Customer Managed Keys architecture showing Key Vault, Entra ID authentication, Managed Identity, and App Service integration",
  "puml": "@startuml Azure_CMK_Architecture\n!include <C4/C4_Container>\n\ntitle Azure Customer Managed Keys (CMK) Architecture\n\nPerson(admin, \"Security Administrator\", \"Manages keys and access policies\")\nPerson(user, \"Application User\", \"Uses the application\")\n\nSystem_Boundary(azure, \"Azure Cloud\") {\n  Container(entra, \"Entra ID\", \"Identity Provider\", \"Authentication and authorization\")\n  Container(kv, \"Azure Key Vault\", \"HSM-backed\", \"Stores and manages CMK encryption keys\")\n  Container(mi, \"Managed Identity\", \"System Assigned\", \"Service identity for App Service\")\n  Container(app, \"App Service\", \"Web Application\", \"Business application\")\n  ContainerDb(storage, \"Azure Storage\", \"Blob Storage\", \"Encrypted data at rest\")\n  ContainerDb(sqldb, \"Azure SQL Database\", \"PaaS Database\", \"Encrypted database\")\n}\n\nSystem_Ext(monitor, \"Azure Monitor\", \"Audit logs and key usage metrics\")\n\nRel(admin, entra, \"Authenticates\")\nRel(admin, kv, \"Manages keys and policies\")\nRel(user, app, \"Uses application\")\nRel(app, mi, \"Uses identity\")\nRel(mi, entra, \"Authenticates\")\nRel(mi, kv, \"Requests keys\")\nRel(kv, entra, \"Validates access\")\nRel(app, storage, \"Read/Write data\")\nRel(app, sqldb, \"Query data\")\nRel(storage, kv, \"Uses CMK for encryption\")\nRel(sqldb, kv, \"Uses CMK for TDE\")\nRel(kv, monitor, \"Audit logs\")\n\n@enduml",
  "style": "c4"
}