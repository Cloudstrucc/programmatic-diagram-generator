<section style="background: var(--light-bg); padding: 60px 0 80px;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="text-center mb-5">
                    <h1>Generate AI Diagram</h1>
                    <p class="text-muted">Describe your architecture and let AI create it</p>
                    <div class="mt-3">
                        <span class="badge bg-success">{{remaining}} diagrams remaining today</span>
                        <span class="badge bg-secondary">{{user.tier}} tier</span>
                    </div>
                </div>

                {{#unless canCreate}}
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    You've reached your daily limit of {{limit}} diagrams. 
                    <a href="/pricing" class="alert-link">Upgrade your plan</a> for more diagrams.
                </div>
                {{/unless}}

                <div class="card shadow" style="border: 2px solid #f0f0f0; border-radius: 15px;">
                    <div class="card-body p-5">
                        <form id="generator-form">
                            <div class="mb-4">
                                <label for="title" class="form-label fw-bold">Diagram Title</label>
                                <input 
                                    type="text" 
                                    class="form-control form-control-lg" 
                                    id="title" 
                                    name="title" 
                                    placeholder="e.g., Azure AKS Production Setup"
                                    required
                                    {{#unless canCreate}}disabled{{/unless}}
                                >
                            </div>

                            <div class="mb-4">
                                <label for="prompt" class="form-label fw-bold">Description</label>
                                <textarea 
                                    class="form-control" 
                                    id="prompt" 
                                    name="prompt" 
                                    rows="4" 
                                    placeholder="Describe your diagram... e.g., 'Azure AKS cluster with load balancer' or 'User login process with validation steps'"
                                    required
                                    {{#unless canCreate}}disabled{{/unless}}
                                ></textarea>
                                <small class="text-muted">Be specific for better results</small>
                            </div>

                            <!-- Format Selection (NEW!) -->
                            <div class="mb-4">
                                <label for="diagramFormat" class="form-label fw-bold">
                                    <i class="bi bi-diagram-3 me-2"></i>Diagram Format
                                </label>
                                <select class="form-select form-select-lg" id="diagramFormat" name="diagramFormat" {{#unless canCreate}}disabled{{/unless}}>
                                    <option value="graphviz">Cloud Architecture (Azure/AWS/GCP)</option>
                                    <option value="graphviz-dot">Traditional Diagrams (Flowcharts/States/Org Charts)</option>
                                </select>
                                <small class="text-muted d-block mt-2" id="format-help">
                                    Best for cloud infrastructure diagrams with proper icons
                                </small>
                            </div>

                            <!-- Style Selection (dynamically updated based on format) -->
                            <div class="mb-4">
                                <label for="style" class="form-label fw-bold">
                                    <i class="bi bi-palette me-2"></i>Style
                                </label>
                                <select class="form-select form-select-lg" id="style" name="style" {{#unless canCreate}}disabled{{/unless}}>
                                    <!-- Cloud Architecture Styles (default) -->
                                    <option value="azure">Azure</option>
                                    <option value="aws">AWS</option>
                                    <option value="gcp">GCP</option>
                                    <option value="k8s">Kubernetes</option>
                                    <option value="generic">Generic</option>
                                </select>
                                <small class="text-muted d-block mt-2" id="style-help">
                                    Choose your cloud provider
                                </small>
                            </div>

                            <div class="mb-4">
                                <label for="quality" class="form-label fw-bold">
                                    <i class="bi bi-sliders me-2"></i>Complexity Level
                                </label>
                                <select class="form-select form-select-lg" id="quality" name="quality" {{#unless canCreate}}disabled{{/unless}}>
                                    <option value="simple">Simple (5-8 components)</option>
                                    <option value="standard" selected>Standard (8-15 components)</option>
                                    <option value="enterprise">Enterprise (15+ components)</option>
                                </select>
                            </div>

                            <!-- Examples Section -->
                            <div class="mb-4">
                                <div class="accordion" id="examplesAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#examplesCollapse">
                                                <i class="bi bi-lightbulb me-2"></i>Example Prompts
                                            </button>
                                        </h2>
                                        <div id="examplesCollapse" class="accordion-collapse collapse" data-bs-parent="#examplesAccordion">
                                            <div class="accordion-body">
                                                <div id="cloud-examples">
                                                    <h6 class="fw-bold">Cloud Architecture Examples:</h6>
                                                    <ul class="small">
                                                        <li><code>Azure AKS cluster with load balancer, KeyVault, and SQL Database</code></li>
                                                        <li><code>AWS 3-tier web app with ELB, EC2, and RDS</code></li>
                                                        <li><code>GCP microservices with Cloud Run and Cloud SQL</code></li>
                                                        <li><code>Kubernetes deployment with ingress, service mesh, and persistent storage</code></li>
                                                    </ul>
                                                </div>
                                                <div id="traditional-examples" style="display: none;">
                                                    <h6 class="fw-bold">Flowchart Examples:</h6>
                                                    <ul class="small">
                                                        <li><code>User login process with email verification and 2FA</code></li>
                                                        <li><code>Order processing workflow from cart to delivery</code></li>
                                                        <li><code>CI/CD pipeline from commit to production deployment</code></li>
                                                    </ul>
                                                    <h6 class="fw-bold mt-3">State Machine Examples:</h6>
                                                    <ul class="small">
                                                        <li><code>Order status states: pending, processing, shipped, delivered, cancelled</code></li>
                                                        <li><code>User session states with timeout and renewal</code></li>
                                                    </ul>
                                                    <h6 class="fw-bold mt-3">Org Chart Examples:</h6>
                                                    <ul class="small">
                                                        <li><code>Software development team structure with managers and engineers</code></li>
                                                        <li><code>IT department hierarchy</code></li>
                                                    </ul>
                                                    <h6 class="fw-bold mt-3">Network Examples:</h6>
                                                    <ul class="small">
                                                        <li><code>Corporate network with firewall, switches, servers, and databases</code></li>
                                                        <li><code>Home network topology with router, WiFi, and IoT devices</code></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg" style="background: var(--secondary-color); border: none;" {{#unless canCreate}}disabled{{/unless}}>
                                    <i class="bi bi-magic me-2"></i>Generate Diagram
                                </button>
                            </div>
                        </form>

                        <div id="status-area" class="mt-4" style="display: none;">
                            <div class="alert alert-info">
                                <div class="d-flex align-items-center">
                                    <div class="spinner-border spinner-border-sm me-3" role="status"></div>
                                    <div>
                                        <strong>Generating your diagram...</strong>
                                        <p class="mb-0 small" id="status-text">Please wait...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Dynamic format/style switching
document.addEventListener('DOMContentLoaded', function() {
    const formatSelect = document.getElementById('diagramFormat');
    const styleSelect = document.getElementById('style');
    const formatHelp = document.getElementById('format-help');
    const styleHelp = document.getElementById('style-help');
    const cloudExamples = document.getElementById('cloud-examples');
    const traditionalExamples = document.getElementById('traditional-examples');

    // Style options for each format
    const styleOptions = {
        'graphviz': {
            styles: [
                { value: 'azure', label: 'Azure' },
                { value: 'aws', label: 'AWS' },
                { value: 'gcp', label: 'GCP' },
                { value: 'k8s', label: 'Kubernetes' },
                { value: 'generic', label: 'Generic' }
            ],
            formatHelp: 'Best for cloud infrastructure diagrams with proper icons',
            styleHelp: 'Choose your cloud provider'
        },
        'graphviz-dot': {
            styles: [
                { value: 'flowchart', label: 'Flowchart / Process Diagram' },
                { value: 'state', label: 'State Machine' },
                { value: 'orgchart', label: 'Organization Chart' },
                { value: 'network', label: 'Network Topology' },
                { value: 'sequence', label: 'Sequence Diagram' }
            ],
            formatHelp: 'Best for process flows, state machines, org charts, and network diagrams',
            styleHelp: 'Choose your diagram type'
        }
    };

    formatSelect.addEventListener('change', function() {
        const format = this.value;
        const config = styleOptions[format];

        // Update style dropdown
        styleSelect.innerHTML = '';
        config.styles.forEach(style => {
            const option = document.createElement('option');
            option.value = style.value;
            option.textContent = style.label;
            styleSelect.appendChild(option);
        });

        // Update help text
        formatHelp.textContent = config.formatHelp;
        styleHelp.textContent = config.styleHelp;

        // Update examples
        if (format === 'graphviz') {
            cloudExamples.style.display = 'block';
            traditionalExamples.style.display = 'none';
        } else {
            cloudExamples.style.display = 'none';
            traditionalExamples.style.display = 'block';
        }
    });
});
</script>

<script src="/js/diagram-generator.js"></script>
